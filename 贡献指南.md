# 贡献指南（快速上手）

本文档为新开发者提供快速上手要点，摘自 `开发者指南.md` 的关键内容，适合在本仓库开始开发与提交前阅读。

1) 环境与启动
- 要求：.NET 8 SDK、Visual Studio 或 VS Code
- 克隆并打开仓库后：
  - 本地构建：`dotnet build`
  - 运行应用：`dotenu0026nbsp;run --project "Test Tool"`
- 配置文件：`appsettings.json`（运行时可被 `IOptionsMonitor<T>` 热加载）

2) 项目分层（快速理解）
- Presentation（UI）
  - `MainForm`, `SettingsForm`, `SerialMonitorForm`
- Business（业务）
  - `ISerialPortService` / `SerialPortService`
  - `IDeviceController` / `PowerDeviceController`
- Data（持久化）
  - `IConfigRepository` / `FileConfigRepository`
- Infrastructure（常量/Helper/扩展）

3) 依赖注入与服务生命周期
- 使用 `Microsoft.Extensions.Hosting` + DI。
- 推荐注册（见 `Program.cs`）：
  - 单例（Singleton）：`ISerialPortService`, `IDeviceController`, `IConfigRepository`, 以及 `MainForm`
  - 瞬态（Transient）：对话框 `SettingsForm`, `SerialMonitorForm`
- 单例要线程安全并实现 `IDisposable`（Host 在停止时会 Dispose）。

4) 代码规范与最佳实践（必须遵守）
- 使用异步 API（async/await）避免阻塞 UI 线程。
- 服务层（Business）不应直接操作 UI；通过事件/回调将状态传到 Presentation 层。
- 实现接口以便单元测试（可替换实现为 Mock）。
- 在单例中使用同步原语（例如 `SemaphoreSlim`）保护共享资源（串口、文件写入）。

5) 常见开发任务
- 添加新设备类型：实现 `IDeviceController` 并在 DI 中注册新实现。
- 替换配置存储：实现 `IConfigRepository`（如数据库）并在 `Program.cs` 注入替换。
- 日志：项目已使用 `ILogger<T>`，在服务中记录关键事件与异常。

6) 设计器与 DI 的兼容性
- 窗体保留参数无参构造以支持 WinForms 设计器；运行时应使用 Host/DI 构造注入依赖。
- 对话窗体应保持瞬态（Transient），通过容器解析或 `ActivatorUtilities.CreateInstance` 创建。

7) 测试
- 建议为 `SerialPortService`、`PowerDeviceController`、`FileConfigRepository` 添加单元测试。
- 基准测试位于 `BenchmarkSuite1`（示例已适配 Logger 注入）。

8) 提交规范（简短）
- 每次功能改动或修复请使用小而清晰的提交（一个逻辑点/commit）。
- 合并到主分支前请确保：构建通过、无未处理异常、关键路径有测试或手动验证。

9) 进一步阅读
- 详细架构、重构计划请参见 `架构设计.md` 与 `开发者指南.md`。

如需我把该仓库的 贡献指南 转为英文版或生成 PR 描述模板，我可以继续处理。