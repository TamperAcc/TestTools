# 📋 项目任务计划追踪

> 此文档用于持久化记录所有任务计划，便于追溯和管理。

---

## 📌 任务索引

| 任务编号 | 任务名称 | 状态 | 创建日期 | 完成日期 |
|---------|---------|------|---------|---------|
| TASK-001 | 串口设置窗口添加一键开启/关闭打印窗口及位置保存功能 | ✅ 已完成 | 2024-12-28 | 2024-12-28 |
| TASK-002 | 窗口位置保存和串口设置窗口按钮修复 | ✅ 已完成 | 2024-12-28 | 2024-12-28 |
| TASK-003 | 项目模块化重构与代码优化 | ✅ 已完成 | 2024-12-28 | 2024-12-28 |
| TASK-004 | 项目结构中文标注完善 | ✅ 已完成 | 2025-12-31 | 2025-12-31 |
| TASK-005 | 串口适配器健壮性与设置窗体接口补全 | ☑ 进行中 | 2026-01-01 | - |
| TASK-006 | 全局优化分阶段计划 | ☑ 进行中 | 2026-01-02 | - |

---

## TASK-001: 串口设置窗口添加一键开启/关闭打印窗口及位置保存功能

**状态**: ✅ 已完成  
**创建日期**: 2024-12-28  
**完成日期**: 2024-12-28

### 完成步骤
- [x] 修改 DeviceConfig 模型添加打印窗口位置属性
- [x] 修改 DeviceConfigJson 添加窗口位置序列化字段
- [x] 修改 ConfigRepository 读写窗口位置配置
- [x] 修改 SerialMonitorForm 添加位置保存/恢复逻辑
- [x] 修改 MainForm 在打开/关闭打印窗口时保存位置
- [x] 修改 MultiDeviceSettingsForm 添加一键开启/关闭打印按钮
- [x] 验证构建成功
- [x] 生成 exe

---

## TASK-002: 窗口位置保存和串口设置窗口按钮修复

**状态**: ✅ 已完成  
**创建日期**: 2024-12-28  
**完成日期**: 2024-12-28

### 完成步骤
- [x] 修改 DeviceModels 添加主窗口和设置窗口位置属性
- [x] 修改 ConfigRepository 读写主窗口和设置窗口位置
- [x] 修改 MainForm 添加关闭时保存位置逻辑
- [x] 修改 MultiDeviceSettingsForm 添加最小化/最大化按钮和位置保存
- [x] 验证构建成功

---

## TASK-003: 项目模块化重构与代码优化

**状态**: ✅ 已完成  
**创建日期**: 2024-12-28  
**完成日期**: 2024-12-28

### 任务背景
基于项目架构分析报告，进行全面的模块化重构和代码优化。

### 优化项清单

#### 阶段一：基础优化（优先级：高）- ✅ 已完成
| 序号 | 优化项 | 状态 | 说明 |
|------|--------|------|------|
| 3.1 | 修复 UIConstants.cs 中文乱码 | ✅ 已完成 | 文件编码问题已修复 |
| 3.2 | 修复 UIHelper.cs 中文乱码 | ✅ 已完成 | 文件编码问题已修复 |
| 3.3 | 修复 IDeviceServices.cs 中文乱码 | ✅ 已完成 | 文件编码问题已修复 |
| 3.4 | 修复 AppConstants.cs 格式问题 | ✅ 已完成 | 代码格式已统一 |
| 3.5 | 添加一键连接/断开功能 | ✅ 已完成 | MainForm 新增功能 |
| 3.6 | 添加一键开启/关闭打印功能 | ✅ 已完成 | MultiDeviceSettingsForm 新增功能 |

#### 阶段二：项目拆分（优先级：中）- 🔄 进行中
| 序号 | 优化项 | 状态 | 说明 |
|------|--------|------|------|
| 3.7 | 创建 TestTool.Core 项目 | ✅ 已完成 | 核心接口和模型迁移到项目目录 |
| 3.8 | 创建 TestTool.Business 项目 | ✅ 已完成 | 业务实现迁移到项目目录 |
| 3.9 | 创建 TestTool.Infrastructure 项目 | ✅ 已完成 | 基础设施代码迁移到项目目录 |
| 3.10 | 创建 TestTool.UI 项目 | ✅ 已完成 | UI 层独立项目创建并编译通过 |
| 3.11 | 迁移现有代码到新项目结构 | ✅ 已完成 | 清理重复源码并仅通过项目引用 |

#### 阶段三：架构优化（优先级：低）- ✅ 已完成
| 序号 | 优化项 | 状态 | 说明 |
|------|--------|------|------|
| 3.12 | 提取重复的 WndProc 代码到基类 | ✅ 已完成 | 三个窗体已继承 ResizableFormBase |
| 3.13 | 合并相似的 EventArgs 类型 | ✅ 已完成 | 创建 DeviceEventArgs<T> 泛型基类 |
| 3.14 | 引入 MVVM/MVP 模式 | ☑ 进行中 | 进一步解耦 UI |
| 3.15 | 添加单元测试项目 | ✅ 已完成 | 提高可测试性 |

### 执行记录

#### 2024-12-28 - 阶段一完成
- [x] 步骤 3.1: 修复 UIConstants.cs 中文乱码
- [x] 步骤 3.2: 修复 UIHelper.cs 中文乱码
- [x] 步骤 3.3: 修复 IDeviceServices.cs 中文乱码
- [x] 步骤 3.4: 修复 AppConstants.cs 格式问题
- [x] 步骤 3.5: 添加一键连接/断开功能
- [x] 步骤 3.6: 添加一键开启/关闭打印功能
- [x] 验证构建成功

#### 2024-12-28 - 阶段三架构优化
- [x] 步骤 3.12: 重构 SerialMonitorForm 继承 ResizableFormBase
- [x] 步骤 3.12: 重构 MultiDeviceSettingsForm 继承 ResizableFormBase  
- [x] 步骤 3.12: 重构 MainForm 继承 ResizableFormBase
- [x] 步骤 3.13: 创建 DeviceEventArgs<T> 泛型基类
- [x] 步骤 3.13: 重构4个EventArgs类继承泛型基类
- [x] 步骤 3.15: 添加单元测试项目并修复构建
- [x] 验证构建成功

#### 2025-12-31 - 阶段二拆分进展
- [x] 步骤 3.7: 创建 TestTool.Core 项目
- [x] 步骤 3.8: 创建 TestTool.Business 项目
- [x] 步骤 3.9: 创建 TestTool.Infrastructure 项目
- [x] 步骤 3.10: 创建 TestTool.UI 项目（独立 WinForms，已通过全量构建）
- [x] 步骤 3.11: 迁移现有代码到新项目结构并清理重复源码
- [x] 全量构建验证通过

#### 2025-12-31 - 阶段三 MVP 初步落地
- [x] MultiDeviceSettingsForm 接入 MVP（新增 Presenter 绑定，主窗体暴露接口）

---

## TASK-004: 项目结构中文标注完善

**状态**: ✅ 已完成  
**创建日期**: 2025-12-31  
**完成日期**: 2025-12-31

### 任务描述
为项目结构文档补充各子文件中文标注，保持与目录注释一致，便于快速定位职责。

### 完成步骤
- [x] 调整项目结构树，补充 Core/Business/Infrastructure 子文件中文说明
- [x] 标注 UI 层各窗体用途
- [x] 保留现有目录级说明，补充文件级说明

---

## 现有项目结构
```
Test Tool/
├── TestTool.Core/                 # 核心层（模型、枚举、接口）
│   ├── Enums/DeviceEnums.cs       # 设备类型/状态枚举
│   ├── Events/DeviceEventArgs.cs  # 设备事件参数基类
│   ├── Models/DeviceModels.cs     # 设备/连接配置与状态模型
│   ├── Models/ProtocolModels.cs   # 协议解析帧模型
│   └── Services/*.cs              # 核心接口
├── TestTool.Business/             # 业务层（实现）
│   └── Services/
│       ├── DefaultSerialPortAdapter.cs # 串口适配器实现
│       ├── Factories.cs                # 工厂实现
│       ├── MainFormCoordinator.cs      # 单设备协调器
│       ├── MultiDeviceCoordinator.cs   # 多设备协调器
│       ├── PowerDeviceController.cs    # 电源控制器
│       ├── SerialPortService.cs        # 串口服务
│       └── SimpleProtocolParser.cs     # 简单协议解析器
├── TestTool.Infrastructure/       # 基础设施层
│   ├── Constants/
│   │   ├── AppConstants.cs        # 应用常量
│   │   ├── UIConstants.cs         # UI 颜色/文案常量
│   │   └── UIFormConstants.cs     # 窗体尺寸常量
│   └── Helpers/UIHelper.cs        # UI 辅助方法
├── Data/ConfigRepository.cs       # 配置仓库（JSON 持久化，链接到业务层）
├── Forms/                         # UI 层
│   ├── Base/ResizableFormBase.cs  # 可调整大小基类
│   ├── MainForm*.cs               # 主窗体
│   ├── MultiDeviceSettingsForm*.cs# 多设备设置窗体
│   ├── SerialMonitorForm*.cs      # 串口监视窗体
│   └── SettingsForm*.cs           # 旧版设置窗体
└── Program.cs                     # 程序入口（DI 配置）
```

---
严格遵循以下任务模板记录操作任务
## 📝 任务模板

```markdown
## TASK-XXX: [任务名称]

**状态**: □ 待开始 | ☑ 进行中 | ✅ 已完成 | ✖ 已取消  
**创建日期**: YYYY-MM-DD  
**完成日期**: -

### 任务描述
[描述任务目标和背景]

### 任务分析
-拆分任务目标
-列出关键点
-分析扩展性维护性可读性

### 任务要求
-Task使用中文
-修改代码直接修改文件,不要通过终端传输代码
-更新任务计划
-验证构建成功
-使用中文注释相关模块 保持一致性

### 步骤清单
- [ ] 步骤1
- [ ] 步骤2
- [ ] 步骤3
...

### 执行记录
[记录执行过程中的重要信息]

### 相关文件
- file1.cs
- file2.cs
```

---

## 📊 统计信息

- **总任务数**: 6
- **已完成**: 4
- **进行中**: 2
- **待开始**: 0

---

*最后更新: 2026-01-05*

---

## TASK-005: 串口适配器健壮性与设置窗体接口补全

**状态**: ☑ 进行中  
**创建日期**: 2026-01-01  
**完成日期**: -

### 任务描述
提升串口适配器的健壮性（超时、幂等释放、状态校验）并补全设置窗体的 MVP 接口构造重载，以保证调用一致和可扩展性。

### 任务分析
- 串口适配器：默认超时、编码、状态检测与幂等 Dispose，避免未打开/已释放读写。
- 设置窗体：补充带 Presenter 构造重载，实现 IMultiDeviceSettingsView 接口方法，支持 Monitor 状态更新与可用端口刷新。
- 验证：全量构建，通过单元测试（如有）。

### 任务要求
- Task 使用中文
- 修改代码直接修改文件,不要通过终端传输代码
- 更新任务计划
- 验证构建成功
- 使用中文注释相关模块 保持一致性

### 步骤清单
- [x] 串口适配器增加默认超时、编码和状态校验
- [x] 串口适配器 Dispose 幺端处理
- [x] 设置窗体补充带 Presenter 构造重载
- [x] 设置窗体实现刷新端口/监视器状态接口
- [ ] 验证构建成功
- [x] 验证构建成功

### 执行记录
- 2026-01-01 完成串口适配器健壮性提升；添加带 Presenter 构造与视图接口实现。
- 2026-01-01 构建验证通过。

### 相关文件
- TestTool.Business/Services/DefaultSerialPortAdapter.cs
- Forms/MultiDeviceSettingsForm.Extensions.cs

---

## TASK-006: 全局优化分阶段计划

**状态**: ☑ 进行中  
**创建日期**: 2026-01-02  
**完成日期**: -

### 任务描述
梳理并分阶段落实全局可优化项（健壮性、性能、架构、测试、UI/UX），形成清单并逐项推进。

### 任务分析
- 健壮性与运维：异常捕获与日志、串口/IO 重试、配置回退、资源释放检查。
- 性能与资源：串口读写缓冲/异步、UI 线程切换减负、重复枚举缓存、配置读写去抖动。
- 架构与解耦：Presenter/MVP 全覆盖，接口化 UI 交互，事件/DTO 统一来源，DI 配置清晰。
- 可测试性：串口/协调器更多单测，UI 逻辑 Presenter 单测，配置仓库回归。
- UI/UX：统一主题与常量、跨线程 UI 更新助手、窗口状态/位置持久化一致、提示文案一致。

### 任务要求
- Task 使用中文
- 修改代码直接修改文件,不要通过终端传输代码
- 使用中文注释相关模块 保持一致性
- 验证构建成功
- 更新任务计划

### 步骤清单
- [x] 阶段一：健壮性与运维（日志、异常、资源释放、配置回退）
- [x] 阶段二：性能与资源（异步/缓冲、缓存可用端口、去抖配置写入）
- [x] 阶段三：架构与测试（Presenter 覆盖、接口统一、单元测试扩充）
- [x] 阶段四：UI/UX（主题/文案统一、跨线程更新助手、窗口状态一致性）

### 执行记录
- 2026-01-02 阶段一：串口配置端口校验回退、事件触发防护、通道安全完成。
- 2026-01-03 阶段二：端口列表缓存 1 秒、配置写入 500ms 去抖与日志。
- 2026-01-04 阶段三：补充串口服务事件健壮性单测，验证异常不影响连接与接收。
- 2026-01-05 阶段四：引入跨线程 SafeInvoke 助手，设置窗体使用统一提示文案。
